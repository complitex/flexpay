<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xsi:schemaLocation="
		   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
		   http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd">

	<bean parent="diffService"
		  autowire-candidate="false"
		  p:registry-ref="typeRegistryAb" />

	<bean id="countryServiceTarget" class="org.flexpay.ab.service.imp.CountryServiceImpl"
		  autowire-candidate="false"
		  p:countryDao-ref="countryDAO"
		  p:countryNameDao-ref="countryNameDAO" />

	<bean id="regionServiceTarget"
		  class="org.flexpay.ab.service.imp.RegionServiceImpl"
		  autowire-candidate="false"
		  p:parentService-ref="countryService"
		  p:townTypeService-ref="townTypeService"
		  p:regionDao-ref="regionDAO"
		  p:regionNameDao-ref="regionNameDAO"
		  p:regionNameTemporalDao-ref="regionNameTemporalDao"
		  p:regionNameTranslationDao-ref="regionNameTranslationDAO"
		  p:countryDao-ref="countryDAO" />

	<bean id="townHistoryChangesListener"
		  parent="historyChangesListenerBase"
		  p:historyBuilder-ref="townHistoryBuilder" />

	<bean id="townService"
		  class="org.flexpay.ab.service.imp.TownServiceImpl"
		  p:parentService-ref="regionService"
		  p:regionDao-ref="regionDAO"
		  p:townDao-ref="townDAO"
		  p:townNameDao-ref="townNameDAO"
		  p:townNameTranslationDao-ref="townNameTranslationDAO"
		  p:townNameTemporalDao-ref="townNameTemporalDao"
		  p:townTypeTemporalDao-ref="townTypeTemporalDao"
		  p:townTypeService-ref="townTypeService"
		  p:sessionUtils-ref="sessionUtils"
		  p:modificationListener-ref="townHistoryChangesListener" />

	<bean id="districtService"
		  class="org.flexpay.ab.service.imp.DistrictServiceImpl"
		  p:parentService-ref="townService"
		  p:townDao-ref="townDAO"
		  p:districtDao-ref="districtDAO"
		  p:districtNameDao-ref="districtNameDAO"
		  p:districtNameTemporalDao-ref="districtNameTemporalDao"
		  p:districtNameTranslationDao-ref="districtNameTranslationDAO" />

	<bean id="streetServiceTarget"
		  class="org.flexpay.ab.service.imp.StreetServiceImpl"
		  autowire-candidate="false"
		  p:parentService-ref="townService"
		  p:townDao-ref="townDAO"
		  p:streetDao-ref="streetDAO"
		  p:streetDaoExt-ref="streetDaoExt"
		  p:streetNameDao-ref="streetNameDAO"
		  p:streetNameTemporalDao-ref="streetNameTemporalDao"
		  p:streetTypeTemporalDao-ref="streetTypeTemporalDao"
		  p:streetNameTranslationDao-ref="streetNameTranslationDAO" />

	<bean id="buildingServiceTarget" class="org.flexpay.ab.service.imp.BuildingServiceImpl"
		  autowire-candidate="false"
		  p:buildingDao-ref="buildingDao"
		  p:buildingsDao-ref="buildingsDao"
		  p:buildingsDaoExt-ref="buildingsDaoExt"
		  p:parentService-ref="streetService"
		  p:districtParentService-ref="districtService" />

	<bean id="addressAttributeTypeServiceTarget" class="org.flexpay.ab.service.imp.AddressAttributeTypeServiceImpl"
		  autowire-candidate="false"
		  p:buildingAttributeTypeDao-ref="addressAttributeTypeDao" />

	<bean id="addressService" class="org.flexpay.ab.service.imp.AddressServiceImpl"
		  p:apartmentService-ref="apartmentService"
		  p:buildingService-ref="buildingService"
		  p:streetService-ref="streetService" />

	<bean id="apartmentService" class="org.flexpay.ab.service.imp.ApartmentServiceImpl"
		  p:apartmentDao-ref="apartmentDao"
		  p:apartmentDaoExt-ref="apartmentDaoExt"
		  p:parentService-ref="buildingService" />

	<bean id="townTypeHistoryChangesListener"
		  parent="historyChangesListenerBase"
		  p:historyBuilder-ref="townTypeHistoryBuilder" />

	<bean id="townTypeServiceTarget"
		  autowire-candidate="false"
		  class="org.flexpay.ab.service.imp.TownTypeServiceImpl"
		  p:townTypeDao-ref="townTypeDAO"
		  p:sessionUtils-ref="sessionUtils"
		  p:modificationListener-ref="townTypeHistoryChangesListener" />

	<bean id="streetTypeServiceTarget"
		  autowire-candidate="false"
		  class="org.flexpay.ab.service.imp.StreetTypeServiceImpl"
		  p:streetTypeDao-ref="streetTypeDAO"
		  p:correctionsService-ref="correctionsServiceAb" />

	<bean id="identityTypeService"
		  class="org.flexpay.ab.service.imp.IdentityTypeServiceImpl"
		  p:identityTypeDao-ref="identityTypeDAO" />

	<bean id="personService" class="org.flexpay.ab.service.imp.PersonServiceImpl"
		  p:personAttributeDao-ref="personAttributeDao"
		  p:identityTypeService-ref="identityTypeService"
		  p:personRegistrationDao-ref="personRegistrationDao"
		  p:personDao-ref="personDao"
		  p:personDaoExt-ref="personDaoExt" />

	<!-- History builders -->
	<bean id="abHistoryBuilderBase"
		  abstract="true"
		  class="org.flexpay.common.persistence.history.impl.HistoryBuilderBase"
		  p:masterIndexService-ref="masterIndexService"
		  p:correctionsService-ref="correctionsServiceAb"
		  p:typeRegistry-ref="typeRegistryAb" />

	<bean id="townTypeHistoryBuilder"
		  parent="abHistoryBuilderBase"
		  class="org.flexpay.ab.service.history.TownTypeHistoryBuilder" />

	<bean id="townHistoryBuilder"
		  parent="abHistoryBuilderBase"
		  class="org.flexpay.ab.service.history.TownHistoryBuilder" />

	<bean id="streetTypeHistoryBuilder"
		  parent="abHistoryBuilderBase"
		  class="org.flexpay.ab.service.history.StreetTypeHistoryBuilder" />

	<!-- History generators -->
	<bean id="townTypeHistoryGenerator"
		  class="org.flexpay.ab.service.history.TownTypeHistoryGenerator"
		  p:diffService-ref="diffService"
		  p:historyBuilder-ref="townTypeHistoryBuilder"
		  p:townTypeService-ref="townTypeService" />

	<bean id="townHistoryGenerator"
		  class="org.flexpay.ab.service.history.TownHistoryGenerator"
		  p:diffService-ref="diffService"
		  p:historyBuilder-ref="townHistoryBuilder"
		  p:typeHistoryGenerator-ref="townTypeHistoryGenerator"
		  p:townService-ref="townService"
		  p:townTypeService-ref="townTypeService" />

	<bean id="streetTypeHistoryGenerator"
		  class="org.flexpay.ab.service.history.StreetTypeHistoryGenerator"
		  p:diffService-ref="diffService"
		  p:historyBuilder-ref="streetTypeHistoryBuilder"
		  p:streetTypeService-ref="streetTypeService" />

	<!-- History handlers -->
	<bean id="abHistoryHandlerBase" abstract="true" autowire-candidate="false"
		  parent="historyHandlerBase"
		  p:typeRegistry-ref="typeRegistryAb" />

	<bean id="townHistoryHandler" parent="abHistoryHandlerBase"
		  class="org.flexpay.ab.service.history.TownHistoryHandler"
		  p:townService-ref="townService"
		  p:historyBuilder-ref="townHistoryBuilder" />

	<bean id="townTypeHistoryHandler" parent="abHistoryHandlerBase"
		  class="org.flexpay.ab.service.history.TownTypeHistoryHandler"
		  p:townTypeService-ref="townTypeService"
		  p:historyBuilder-ref="townTypeHistoryBuilder" />

	<bean id="streetTypeHistoryHandler" parent="abHistoryHandlerBase"
		  class="org.flexpay.ab.service.history.StreetTypeHistoryHandler"
		  p:streetTypeService-ref="streetTypeService"
		  p:historyBuilder-ref="streetTypeHistoryBuilder" />

	<bean id="abObjectsSyncer" parent="objectsSyncer">
		<property name="handlers">
			<list merge="true">
				<ref bean="townHistoryHandler" />
				<ref bean="townTypeHistoryHandler" />
				<ref bean="streetTypeHistoryHandler" />
			</list>
		</property>
	</bean>

</beans>
