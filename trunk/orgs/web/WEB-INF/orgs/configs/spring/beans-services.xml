<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xsi:schemaLocation="
		   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
		   http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd">

	<bean id="orgsObjectsFactoryHolder"
		  class="org.flexpay.orgs.service.imp.OrgsObjectsFactoryHolder"
		  p:factory-ref="orgsObjectsFactoryImpl" />

	<bean id="orgsObjectsFactoryImpl"
		  autowire-candidate="false"
		  class="org.flexpay.orgs.service.imp.OrgsObjectsFactoryImpl" />

	<bean id="orgsObjectsFactory"
		  class="org.flexpay.orgs.service.imp.OrgsObjectsFactoryProxy"
		  p:factoryHolder-ref="orgsObjectsFactoryHolder" />

	<bean id="organisationInstanceService"
		  abstract="true"
		  class="org.flexpay.orgs.service.imp.OrganizationInstanceServiceImpl"
		  p:sessionUtils-ref="sessionUtils" />

	<bean id="organizationHistoryChangesListener"
		  parent="historyChangesListenerBase"
		  p:historyBuilder-ref="organizationHistoryBuilder" />

	<bean id="organizationServiceTarget"
		  autowire-candidate="false"
		  class="org.flexpay.orgs.service.imp.OrganizationServiceImpl"
		  p:sessionUtils-ref="sessionUtils"
		  p:modificationListener-ref="organizationHistoryChangesListener"
		  p:organizationDao-ref="organizationDao" />

	<bean id="subdivisionHistoryChangesListener"
		  parent="historyChangesListenerBase"
		  p:historyBuilder-ref="subdivisionHistoryBuilder" />

	<bean id="subdivisionService"
		  class="org.flexpay.orgs.service.imp.SubdivisionServiceImpl"
		  p:sessionUtils-ref="sessionUtils"
		  p:modificationListener-ref="subdivisionHistoryChangesListener"
		  p:subdivisionDao-ref="subdivisionDao"
		  p:organizationService-ref="organizationService" />

	<bean id="bankHistoryChangesListener"
		  parent="historyChangesListenerBase"
		  p:historyBuilder-ref="bankHistoryBuilder" />

	<bean id="bankServiceTarget"
		  autowire-candidate="false"
		  class="org.flexpay.orgs.service.imp.BankServiceImpl"
		  parent="organisationInstanceService"
		  p:modificationListener-ref="bankHistoryChangesListener"
		  p:instanceDao-ref="bankDao" />

	<bean id="cashboxHistoryChangesListener"
		  parent="historyChangesListenerBase"
		  p:historyBuilder-ref="cashboxHistoryBuilder" />

	<bean id="cashboxServiceTarget"
		  autowire-candidate="false"
		  class="org.flexpay.orgs.service.imp.CashboxServiceImpl"
		  p:sessionUtils-ref="sessionUtils"
		  p:modificationListener-ref="cashboxHistoryChangesListener"
		  p:cashboxDao-ref="cashboxDao" />

	<bean id="paymentsCollectorHistoryChangesListener"
		  parent="historyChangesListenerBase"
		  p:historyBuilder-ref="paymentsCollectorHistoryBuilder" />

	<bean id="paymentsCollectorServiceTarget"
		  autowire-candidate="false"
		  class="org.flexpay.orgs.service.imp.PaymentsCollectorServiceImpl"
		  parent="organisationInstanceService"
		  p:modificationListener-ref="paymentsCollectorHistoryChangesListener"
		  p:instanceDao-ref="paymentsCollectorDao" />

	<bean id="paymentPointHistoryChangesListener"
		  parent="historyChangesListenerBase"
		  p:historyBuilder-ref="paymentPointHistoryBuilder" />

	<bean id="paymentPointServiceTarget"
		  autowire-candidate="false"
		  class="org.flexpay.orgs.service.imp.PaymentPointServiceImpl"
		  p:sessionUtils-ref="sessionUtils"
		  p:modificationListener-ref="paymentPointHistoryChangesListener"
		  p:paymentPointDao-ref="paymentPointDao" />

	<bean id="serviceOrganizationHistoryChangesListener"
		  parent="historyChangesListenerBase"
		  p:historyBuilder-ref="serviceOrganizationHistoryBuilder" />

	<bean id="serviceOrganizationServiceTarget"
		  autowire-candidate="false"
		  class="org.flexpay.orgs.service.imp.ServiceOrganizationServiceImpl"
		  p:sessionUtils-ref="sessionUtils"
		  p:modificationListener-ref="serviceOrganizationHistoryChangesListener"
		  p:serviceOrganizationDao-ref="serviceOrganizationDao" />

	<bean id="serviceProviderHistoryChangesListener"
		  parent="historyChangesListenerBase"
		  p:historyBuilder-ref="serviceProviderHistoryBuilder" />

	<bean id="serviceProviderServiceTarget"
		  autowire-candidate="false"
		  class="org.flexpay.orgs.service.imp.ServiceProviderServiceImpl"
		  p:serviceProviderDao-ref="serviceProviderDao"
		  p:serviceProviderDaoExt-ref="serviceProviderDaoExt"
		  p:sessionUtils-ref="sessionUtils"
		  p:modificationListener-ref="serviceProviderHistoryChangesListener"
		  p:dataSourceDescriptionDao-ref="dataSourceDescriptionDao" />

	<bean id="classToTypeRegistryOrgs"
		  autowire-candidate="false"
		  class="org.flexpay.orgs.service.importexport.impl.ClassToTypeRegistryOrgs" />

	<bean id="classToTypeRegistryFactoryOrgs"
		  depends-on="classToTypeRegistryFactory"
		  class="org.flexpay.common.service.importexport.imp.ClassToTypeRegistryFactory">
		<property name="registry">
			<bean class="org.flexpay.common.service.importexport.imp.CompositeClassToTypeRegistry">
				<property name="registries">
					<list>
						<ref bean="classToTypeRegistryOrgs" />
						<ref bean="classToTypeRegistryCommon" />
					</list>
				</property>
			</bean>
		</property>
	</bean>

	<!-- History builders -->
	<bean id="organizationHistoryBuilder"
		  parent="historyBuilderBase"
		  class="org.flexpay.orgs.service.history.OrganizationHistoryBuilder" />

	<bean id="paymentPointHistoryBuilder"
		  parent="historyBuilderBase"
		  class="org.flexpay.orgs.service.history.PaymentPointHistoryBuilder"
		  p:collectorService-ref="paymentsCollectorService" />

	<bean id="bankHistoryBuilder"
		  parent="historyBuilderBase"
		  class="org.flexpay.orgs.service.history.BankHistoryBuilder"
		  p:organizationService-ref="organizationService" />

	<bean id="cashboxHistoryBuilder"
		  parent="historyBuilderBase"
		  class="org.flexpay.orgs.service.history.CashboxHistoryBuilder"
		  p:pointService-ref="paymentPointService" />

	<bean id="subdivisionHistoryBuilder"
		  parent="historyBuilderBase"
		  class="org.flexpay.orgs.service.history.SubdivisionHistoryBuilder"
		  p:organizationService-ref="organizationService"
		  p:subdivisionService-ref="subdivisionService" />

	<bean id="serviceOrganizationHistoryBuilder"
		  parent="historyBuilderBase"
		  class="org.flexpay.orgs.service.history.ServiceOrganizationHistoryBuilder"
		  p:organizationService-ref="organizationService"
		  p:objectsFactory-ref="orgsObjectsFactory" />

	<bean id="serviceProviderHistoryBuilder"
		  parent="historyBuilderBase"
		  class="org.flexpay.orgs.service.history.ServiceProviderHistoryBuilder"
		  p:organizationService-ref="organizationService" />

	<bean id="paymentsCollectorHistoryBuilder"
		  parent="historyBuilderBase"
		  class="org.flexpay.orgs.service.history.PaymentsCollectorHistoryBuilder"
		  p:organizationService-ref="organizationService" />

	<!-- History generators -->
	<bean id="organizationHistoryGenerator"
		  class="org.flexpay.orgs.service.history.OrganizationHistoryGenerator"
		  p:diffService-ref="diffService"
		  p:historyBuilder-ref="organizationHistoryBuilder"
		  p:organizationService-ref="organizationService" />

	<bean id="organizationInstanceHistoryGenerator"
		  abstract="true"
		  class="org.flexpay.orgs.service.history.OrganizationInstanceHistoryGenerator"
		  p:diffService-ref="diffService" />

	<bean id="bankHistoryGenerator"
		  parent="organizationInstanceHistoryGenerator"
		  p:instanceService-ref="bankService"
		  p:historyBuilder-ref="bankHistoryBuilder" />

	<bean id="cashboxHistoryGenerator"
		  class="org.flexpay.orgs.service.history.CashboxHistoryGenerator"
		  p:diffService-ref="diffService"
		  p:historyBuilder-ref="cashboxHistoryBuilder"
		  p:cashboxService-ref="cashboxService" />

	<bean id="subdivisionHistoryGenerator"
		  class="org.flexpay.orgs.service.history.SubdivisionHistoryGenerator"
		  p:diffService-ref="diffService"
		  p:historyBuilder-ref="subdivisionHistoryBuilder"
		  p:subdivisionService-ref="subdivisionService" />

	<bean id="serviceOrganizationHistoryGenerator"
		  parent="organizationInstanceHistoryGenerator"
		  p:instanceService-ref="serviceOrganizationService"
		  p:historyBuilder-ref="serviceOrganizationHistoryBuilder" />

	<bean id="serviceProviderHistoryGenerator"
		  parent="organizationInstanceHistoryGenerator"
		  p:instanceService-ref="serviceProviderService"
		  p:historyBuilder-ref="serviceProviderHistoryBuilder" />

	<bean id="paymentsCollectorHistoryGenerator"
		  parent="organizationInstanceHistoryGenerator"
		  p:instanceService-ref="paymentsCollectorService"
		  p:historyBuilder-ref="paymentsCollectorHistoryBuilder" />

	<bean id="paymentPointHistoryGenerator"
		  class="org.flexpay.orgs.service.history.PaymentPointHistoryGenerator"
		  p:diffService-ref="diffService"
		  p:historyBuilder-ref="paymentPointHistoryBuilder"
		  p:paymentPointService-ref="paymentPointService" />

	<!-- History handlers -->
	<bean id="orgsHistoryHandlerBase"
		  abstract="true"
		  autowire-candidate="false"
		  parent="historyHandlerBase"
		  p:historyHandlerHelper-ref="historyHandlerHelper"
		  p:typeRegistry-ref="classToTypeRegistry" />

	<bean id="bankHistoryHandler"
		  parent="orgsHistoryHandlerBase"
		  p:instanceService-ref="bankService"
		  p:historyBuilder-ref="bankHistoryBuilder"
		  class="org.flexpay.orgs.service.history.BankHistoryHandler" />

	<bean id="cashboxHistoryHandler"
		  parent="orgsHistoryHandlerBase"
		  class="org.flexpay.orgs.service.history.CashboxHistoryHandler"
		  p:cashboxService-ref="cashboxService"
		  p:historyBuilder-ref="cashboxHistoryBuilder" />

	<bean id="subdivisionHistoryHandler"
		  parent="orgsHistoryHandlerBase"
		  class="org.flexpay.orgs.service.history.SubdivisionHistoryHandler"
		  p:subdivisionService-ref="subdivisionService"
		  p:historyBuilder-ref="subdivisionHistoryBuilder" />

	<bean id="paymentsCollectorHistoryHandler"
		  parent="orgsHistoryHandlerBase"
		  p:instanceService-ref="paymentsCollectorService"
		  p:historyBuilder-ref="paymentsCollectorHistoryBuilder"
		  class="org.flexpay.orgs.service.history.PaymentsCollectorHistoryHandler" />

	<bean id="serviceOrganizationHistoryHandler"
		  parent="orgsHistoryHandlerBase"
		  class="org.flexpay.orgs.service.history.ServiceOrganizationHistoryHandler"
		  p:instanceService-ref="serviceOrganizationService"
		  p:historyBuilder-ref="serviceOrganizationHistoryBuilder"
		  p:objectsFactory-ref="orgsObjectsFactory" />

	<bean id="serviceProviderHistoryHandler"
		  parent="orgsHistoryHandlerBase"
		  p:instanceService-ref="serviceProviderService"
		  p:historyBuilder-ref="serviceProviderHistoryBuilder"
		  class="org.flexpay.orgs.service.history.ServiceProviderHistoryHandler" />

	<bean id="organizationHistoryHandler"
		  parent="orgsHistoryHandlerBase"
		  class="org.flexpay.orgs.service.history.OrganizationHistoryHandler"
		  p:historyBuilder-ref="organizationHistoryBuilder"
		  p:organizationService-ref="organizationService" />

	<bean id="paymentPointHistoryHandler"
		  parent="orgsHistoryHandlerBase"
		  class="org.flexpay.orgs.service.history.PaymentPointHistoryHandler"
		  p:historyBuilder-ref="paymentPointHistoryBuilder"
		  p:paymentPointService-ref="paymentPointService" />

	<bean id="orgsObjectsSyncer" parent="objectsSyncer">
		<property name="handlers">
			<list merge="true">
				<ref bean="paymentPointHistoryHandler" />
				<ref bean="paymentsCollectorHistoryHandler" />
				<ref bean="serviceOrganizationHistoryHandler" />
				<ref bean="serviceProviderHistoryHandler" />
				<ref bean="bankHistoryHandler" />
				<ref bean="cashboxHistoryHandler" />
				<ref bean="subdivisionHistoryHandler" />
				<ref bean="organizationHistoryHandler" />
			</list>
		</property>
	</bean>

</beans>
