<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
		"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
		"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.flexpay.sz.persistence">

	<class name="SzFile" table="sz_files_tbl">
		<id name="id" column="id">
			<generator class="native" />
		</id>
		<property name="fileYear" column="file_year" not-null="true" />
		<property name="fileMonth" column="file_month" not-null="true" />
        <property name="importDate" column="import_date" not-null="true" />
        <property name="isActually" column="is_actually" not-null="true" />
		<property name="userName" column="user_name" not-null="true" />
        <many-to-one name="oszn" class="Oszn" column="oszn_id" not-null="true" />
        <many-to-one name="uploadedFile" column="uploaded_file_id" unique="true" not-null="true" cascade="all" />
        <many-to-one name="fileToDownload" column="file_to_download_id" unique="true" cascade="all" />
        <many-to-one name="type" class="org.flexpay.common.persistence.FPFileType" foreign-key="sz_files_tbl_type_id" not-null="true">
            <column name="type_id">
                <comment>SZ file type reference</comment>
            </column>
        </many-to-one>
        <many-to-one name="status" class="org.flexpay.common.persistence.FPFileStatus" foreign-key="sz_files_tbl_status_id" not-null="true">
            <column name="status_id">
                <comment>SZ file status reference</comment>
            </column>
        </many-to-one>
	</class>

    <query name="SzFile.findSzFiles">
        select distinct s
        from SzFile s
        left join fetch s.oszn
        left join fetch s.uploadedFile
        left join fetch s.fileToDownload
        left join fetch s.status
        left join fetch s.type
    </query>

    <query name="SzFile.findSzFiles.count">
        select count(*)
        from SzFile s
    </query>

    <query name="SzFile.readFull">
		select distinct s
		from SzFile s
			left join fetch s.oszn
            left join fetch s.uploadedFile
			left join fetch s.fileToDownload 
            left join fetch s.status
            left join fetch s.type
            left join fetch s.uploadedFile.module
            left join fetch s.fileToDownload.module
            left join fetch s.status.module
            left join fetch s.type.module 
		where s.id=?
	</query>

	<query name="SzFile.listSzFiles">
		select distinct s
		from SzFile s
			left join fetch s.oszn
			left join fetch s.uploadedFile
			left join fetch s.fileToDownload
            left join fetch s.status
            left join fetch s.type
	</query>

</hibernate-mapping>
        