<?xml version="1.0" encoding="UTF-8"?>

<process-definition name="ParseFPRegistryProcess"
					xmlns="http://jbpm.org/3/jpdl"
					xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
					xsi:schemaLocation="http://jbpm.org/3/jpdl http://jbpm.org/xsd/jpdl-3.0.xsd">

	<swimlane name="worker">
		<assignment class="org.flexpay.common.process.JobManagerAssignmentHandler" />
	</swimlane>

	<start-state name="start">
		<transition to="GetRegistryMessage" />
	</start-state>

    <decision name="GetRegistryMessage">
		<handler class="org.flexpay.common.process.handler.FlexPayDecisionHandler" />
        <transition name="next" to="ProcessRegistryMessage" />
        <transition name="error" to="RemoveRegistry" />
        <event type="node-enter">
            <action name="task" config-type="bean" class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
                <targetBean>getRegistryMessageActionHandler</targetBean>
                <factoryKey>jbpmConfiguration</factoryKey>
            </action>
        </event>
    </decision>

    <decision name="ProcessRegistryMessage">
		<handler class="org.flexpay.common.process.handler.FlexPayDecisionHandler" />
		<transition name="next" to="GetRegistryMessage"/>
        <transition name="header" to="ProcessHeader" />
        <transition name="record" to="ProcessRecord" />
        <transition name="footer" to="ProcessFooter" />
        <transition name="empty" to="ProcessRegistryMessage" />
        <transition name="error" to="RemoveRegistry" />
        <transition name="end" to="end" />
        <event type="node-enter">
            <action name="task" config-type="bean" class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
                <targetBean>processRegistryMessageActionHandler</targetBean>
                <factoryKey>jbpmConfiguration</factoryKey>
            </action>
        </event>
    </decision>

    <decision name="ProcessHeader">
		<handler class="org.flexpay.common.process.handler.FlexPayDecisionHandler" />
        <transition name="next" to="ProcessRegistryMessage" />
        <transition name="error" to="end" />
        <event type="node-enter">
            <action name="task" config-type="bean" class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
                <targetBean>processHeaderActionHandler</targetBean>
                <factoryKey>jbpmConfiguration</factoryKey>
            </action>
        </event>
    </decision>

    <decision name="ProcessRecord">
		<handler class="org.flexpay.common.process.handler.FlexPayDecisionHandler" />
        <transition name="next" to="ProcessRegistryMessage" />
        <transition name="error" to="RemoveRegistry" />
        <event type="node-enter">
            <action name="task" config-type="bean" class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
                <targetBean>processRecordActionHandler</targetBean>
                <factoryKey>jbpmConfiguration</factoryKey>
            </action>
        </event>
    </decision>

    <decision name="ProcessFooter">
		<handler class="org.flexpay.common.process.handler.FlexPayDecisionHandler" />
        <transition name="next" to="ProcessRegistryMessage" />
        <transition name="error" to="RemoveRegistry" />
        <event type="node-enter">
            <action name="task" config-type="bean" class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
                <targetBean>processFooterActionHandler</targetBean>
                <factoryKey>jbpmConfiguration</factoryKey>
            </action>
        </event>
    </decision>

    <decision name="RemoveRegistry">
		<handler class="org.flexpay.common.process.handler.FlexPayDecisionHandler" />
        <transition name="next" to="end" />
        <transition name="error" to="end" />
        <event type="node-enter">
            <action name="task" config-type="bean" class="org.springmodules.workflow.jbpm31.JbpmHandlerProxy">
                <targetBean>removeRegistryActionHandler</targetBean>
                <factoryKey>jbpmConfiguration</factoryKey>
            </action>
        </event>
    </decision>

	<end-state name="end" />

</process-definition>
